<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plots</title>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>-->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>
<body>
<h1>Plots showing benchmarks</h1>
<div id="visualization"></div>
<!--<div id="tester" style="width:600px;height:250px;"></div>-->
<p>Choose file with benchmark results ('results.json'):</p>
<input type="file" id="file-input" />
<div id="tester"></div>
<!--<h3>Contents of the file:</h3>-->
<!--<pre id="file-content"></pre>-->
<script type="text/javascript">

    var makePlot = async function (data,name,element) {

        var title = document.createElement("div");
        title.style.margin = "3px";
        title.innerHTML = " Plot for "+name+" (sec):";

        element.appendChild(title);

        var div = document.createElement("div");
        div.style.width = "600px";
        div.style.height = "200px";
        div.style.background = "blue";
        div.style.color = "white";
        div.style.margin = "3px";

        element.appendChild(div);

        console.log('makePlot:resultsArr:',data);

        var x = [];
        var y = [];

        for (var a = 0; a < data.length; a++){
           await x.push(data[a].name);
           await y.push(data[a].val/1000000000);

        }

        await console.log('x',x);
        await console.log('y',y);

        Plotly.plot(div, [{
            x: x,
            y: y,
            type: 'bar'
        }], {
            margin: {t: 0}
        });

    };

    var displayResults = function(string){

        var json = JSON.parse(string);
        console.log('json',json);

        Object.keys(json).forEach(function (tc) { //for each test case

            var div = document.createElement("div");
            div.style.margin = "3px 3px 40px 3px";
            div.style.border = "2px dotted yellow";
            document.getElementById("tester").appendChild(div);

            var title = document.createElement("h3");
            title.innerHTML = " Test case "+tc+": "+json[tc].duration[0].msg+":";
            div.appendChild(title);

            var plotGroup = document.createElement("div");
            plotGroup.style.margin = "3px";
            plotGroup.style.border = "3px solid grey";
            div.appendChild(plotGroup);

            Object.keys(json[tc]).forEach(function (tt) { // for each time type
                makePlot(json[tc][tt],tt,plotGroup);

            })
        });
    };

    function readSingleFile(e) {
        var file = e.target.files[0];
        if (!file) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
            var contents = e.target.result;
            displayResults(contents);
        };
        reader.readAsText(file);
    }

    document.getElementById('file-input')
        .addEventListener('change', readSingleFile, false);
</script>
</body>
</html>