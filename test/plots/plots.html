<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plots</title>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>-->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>
<body>
halo hejze
<div id="visualization"></div>
<div id="tester" style="width:600px;height:250px;"></div>
<input type="file" id="file-input" />
<!--<h3>Contents of the file:</h3>-->
<!--<pre id="file-content"></pre>-->
<script type="text/javascript">

    var makePlot = async function (i,resultsArr) {

        var div = document.createElement("div");
        div.style.width = "600px";
        div.style.height = "250px";
        div.style.background = "red";
        div.style.color = "white";
        div.innerHTML = "plot TODO:";

        document.getElementById("tester").appendChild(div);

        var x = [];
        var y = [];

        for (var a = 0; a < resultsArr[i]; a++){
           await x.push(resultsArr[i][a].name);
           await x.push(resultsArr[i][a].val);
        }

        await console.log('x',x);
        await console.log('y',y);

        await Plotly.plot(div, [{
            // x: [1, 2, 3, 4, 5],
            // y: [1, 2, 4, 8, 16]
            x: x,
            y: y,
            type: 'bar'
        }], {
            margin: {t: 0}
        });

    };

    var displayResults = function(string){


        var json = JSON.parse(string);


        Object.keys(json).forEach(function (i) {

            // console.log(i);
            // console.log(i+1);
            makePlot(i,json);


        });
    };

    function readSingleFile(e) {
        var file = e.target.files[0];
        if (!file) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
            var contents = e.target.result;
            displayResults(contents);
        };
        reader.readAsText(file);
    }

    document.getElementById('file-input')
        .addEventListener('change', readSingleFile, false);
</script>
</body>
</html>